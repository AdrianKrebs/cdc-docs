<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Implementation | Consumer Driven Contracts</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/cdc-docs/assets/css/4.styles.308e5972.css" as="style"><link rel="preload" href="/cdc-docs/assets/js/app.96813fdf.js" as="script"><link rel="preload" href="/cdc-docs/assets/js/2.a2d0e325.js" as="script"><link rel="prefetch" href="/cdc-docs/assets/js/0.e62d8754.js"><link rel="prefetch" href="/cdc-docs/assets/js/1.d2b9b925.js"><link rel="prefetch" href="/cdc-docs/assets/js/3.3672a43d.js">
    <link rel="stylesheet" href="/cdc-docs/assets/css/4.styles.308e5972.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/cdc-docs/" class="home-link router-link-active"><!----><span class="site-name">
      Consumer Driven Contracts
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><a href="/cdc-docs/intro.html" class="sidebar-link">Introduction</a></li><li><a href="/cdc-docs/start.html" class="sidebar-link">Getting started</a></li><li><a href="/cdc-docs/implementation.html" class="active sidebar-link">Implementation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cdc-docs/implementation.html#dsl" class="sidebar-link">DSL</a></li><li class="sidebar-sub-header"><a href="/cdc-docs/implementation.html#pact-broker" class="sidebar-link">Pact Broker</a></li><li class="sidebar-sub-header"><a href="/cdc-docs/implementation.html#pact-in-comparison-to-other-api-testing-documentation-frameworks" class="sidebar-link">Pact in comparison to other API testing/documentation frameworks</a></li><li class="sidebar-sub-header"><a href="/cdc-docs/implementation.html#experiences" class="sidebar-link">Experiences</a></li><li class="sidebar-sub-header"><a href="/cdc-docs/implementation.html#pitfalls" class="sidebar-link">Pitfalls</a></li><li class="sidebar-sub-header"><a href="/cdc-docs/implementation.html#limitations" class="sidebar-link">Limitations</a></li><li class="sidebar-sub-header"><a href="/cdc-docs/implementation.html#sources" class="sidebar-link">Sources</a></li></ul></li></ul></div><div class="page"><div class="content"><h2 id="dsl"><a href="#dsl" aria-hidden="true" class="header-anchor">#</a> DSL</h2><p>Pact provides an easy to use DSL to write your customer expectations.</p><div class="language- extra-class"><pre class="language-text"><code>new PactDslJsonArray()
    .array()                            # open an array
    .stringValue(&quot;a1&quot;)                  # choose the method that is valid for arrays
    .stringValue(&quot;a2&quot;)                  # choose the method that is valid for arrays
    .closeArray()                       # close the array
    .array()                            # open an array
    .numberValue(1)                     # choose the method that is valid for arrays
    .numberValue(2)                     # choose the method that is valid for arrays
    .closeArray()                       # close the array
    .array()                            # open an array
    .object()                           # now we work with an object
    .stringValue(&quot;foo&quot;, &quot;Foo&quot;)          # choose the method that is valid for objects
    .closeObject()                      # close the object and we're back in the array
    .closeArray()                       # close the array
</code></pre></div><p><a href="https://git.panter.ch/panter/pan-103-consumer/blob/master/src/test/java/ch/panter/cdc/consumer/GoalConsumerPactTest.java">Example Consumer Test</a></p><h3 id="headers"><a href="#headers" aria-hidden="true" class="header-anchor">#</a> Headers</h3><p>The Pact DSL offers a convinient way to do a matching on request and response headers.</p><div class="language- extra-class"><pre class="language-text"><code>.given(&quot;default&quot;)
	.uponReceiving(&quot;retrieving goal data&quot;)
	.path(&quot;/goals&quot;)
	.headers(requestHeaders)
</code></pre></div><h3 id="authentication"><a href="#authentication" aria-hidden="true" class="header-anchor">#</a> Authentication</h3><p>Sometimes you may need to add things to the requests that can't be persisted in a pact file. Examples of these would be authentication tokens, which have a small life span.</p><div class="language- extra-class"><pre class="language-text"><code>@TargetRequestFilter
public void exampleRequestFilter(HttpRequest request) {
	request.addHeader(&quot;Authorization&quot;, &quot;OAUTH hdsagasjhgdjashgdah...&quot;);
}
</code></pre></div><h2 id="pact-broker"><a href="#pact-broker" aria-hidden="true" class="header-anchor">#</a> Pact Broker</h2><p>How do could we share Pacts?
Sharing contracts by email works pretty well. But as soon as you have multiple services using pact, you need some kind of versioning for your pacts.
The soulution is called <a href="https://github.com/pact-foundation/pact_broker">Pact Broker</a>.</p><p>A Pact Broker isn't just a file storage:</p><ul><li>The Broker provides Versioning, Tagging, Rest-API</li><li>Dependency Graph</li><li>Living documentation for free</li><li>Build Pipeline integration</li></ul><p><img src="broker.jpg" alt="broker"></p><p><a href="https://pact-broker.cdc.panter.biz/">Example Broker</a></p><h3 id="how-to-setup-a-pact-broker"><a href="#how-to-setup-a-pact-broker" aria-hidden="true" class="header-anchor">#</a> How to setup a pact broker:</h3><ul><li><code>docker pull dius/pact-broker</code></li><li>Setup a postgres database</li><li>Ready to go</li></ul><h3 id="how-to-publish-pact-files-to-the-broker"><a href="#how-to-publish-pact-files-to-the-broker" aria-hidden="true" class="header-anchor">#</a> How to publish pact files to the broker:</h3><ul><li>Configure <code>brokerUrl</code> and <code>pactDirectory</code></li><li>Run <code>mvn pact:publish</code> to push your contracts to the broker</li></ul><h3 id="how-to-pull-pact-files-from-the-broker"><a href="#how-to-pull-pact-files-from-the-broker" aria-hidden="true" class="header-anchor">#</a> How to pull pact files from the broker:</h3><ul><li>Run <code>mvn pact:verify</code> to pull all the contracts and verify your provider against it</li><li>Publish results of a provider verification with setting the following system property:
<code>-Dpact.verifier.publishResults=true</code></li></ul><div class="tip custom-block"><p class="custom-block-title">How to add new interactions without breaking everything</p><p>In summary: keep the CI running against a stable version of the pact, while simultaneously providing a new version for the provider team so they can update their code and provider states.
Once both the stable and the new versions of the pact are green, the new version can be published as the stable version.</p></div><h2 id="pact-in-comparison-to-other-api-testing-documentation-frameworks"><a href="#pact-in-comparison-to-other-api-testing-documentation-frameworks" aria-hidden="true" class="header-anchor">#</a> Pact in comparison to other API testing/documentation frameworks</h2><table><thead><tr><th>Feature</th><th>Pact</th><th>Restdocs</th><th>Swagger</th></tr></thead><tbody><tr><td>Live Documentation</td><td>yes</td><td>yes</td><td>no</td></tr><tr><td>HATEOAS Support</td><td>yes</td><td>yes</td><td>no</td></tr><tr><td>Integration/ Maintainance effort</td><td>high</td><td>high</td><td>low</td></tr><tr><td>Contracts</td><td>yes</td><td>no</td><td>no</td></tr><tr><td>Versioning</td><td>yes</td><td>partly</td><td>partly</td></tr><tr><td>Universallity</td><td>yes</td><td>partly</td><td>no</td></tr></tbody></table><p>As this table shows, these tools solve different problems and can be used together.
A Pact documents the integration between a particular consumer and provider very well. However, it doesn't provide general documentation for a provider, which Swagger and RESTDocs do very well.</p><h2 id="experiences"><a href="#experiences" aria-hidden="true" class="header-anchor">#</a> Experiences</h2><div class="tip custom-block"><p class="custom-block-title">Experiences</p><ul><li>Increases confidence when coding &amp; deploying (CD)</li><li>Collaborative API design</li><li>Living API documentation</li></ul></div><h2 id="pitfalls"><a href="#pitfalls" aria-hidden="true" class="header-anchor">#</a> Pitfalls</h2><div class="warning custom-block"><p class="custom-block-title">Pitfalls</p><ul><li>Provider state setup for each interaction (Pre conditions, state  - even if it should be stateless)</li><li>Getting used to DSL is hard</li><li>Don't limit to happy path (Response code when user from UserService doesn't exist)</li><li>Automation isn't trivial (Pipeline)</li></ul></div><h2 id="limitations"><a href="#limitations" aria-hidden="true" class="header-anchor">#</a> Limitations</h2><ul><li>Limited Media Type support (no XML)</li><li>No Websocket support</li></ul><h2 id="sources"><a href="#sources" aria-hidden="true" class="header-anchor">#</a> Sources</h2><ul><li><a>https://martinfowler.com/articles/consumerDrivenContracts.html</a></li><li><a>https://docs.pact.io/</a></li><li><a>https://github.com/DiUS/pact-jvm</a></li><li><a>https://pierrevincent.github.io/2017/03/increasing-collaboration-and-confidence-with-consumer-driven-contracts-testing/</a></li></ul></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ‚Üê <a href="/cdc-docs/start.html" class="prev">
          Getting started
        </a></span><!----></p></div></div></div></div>
    <script src="/cdc-docs/assets/js/2.a2d0e325.js" defer></script><script src="/cdc-docs/assets/js/app.96813fdf.js" defer></script>
  </body>
</html>
